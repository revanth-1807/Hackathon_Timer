<!DOCTYPE html>
<html>
<head>
    <title>Hackathon Countdown</title>


    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* ðŸ”¥ DARK BODY */
body {
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-family: Arial, sans-serif;

    background: radial-gradient(circle at top, #020617, #0f172a);
    color: #e2e8f0;
}

/* TITLE */
h1 {
    font-size: 32px;
    margin-bottom: 30px;
    color: #38bdf8;
    letter-spacing: 1px;
}

/* TIMER BOX */
.timer-box {
    text-align: center;
    padding: 30px;
}

/* CIRCLE */
.circle {
    position: relative;
    width: 250px;
    height: 250px;
}

svg {
    transform: rotate(-90deg);
}

circle {
    fill: none;
    stroke-width: 12;
}

/* Background ring */
.bg {
    stroke: #1e293b;
}

/* ðŸ”¥ Neon progress */
.progress {
    stroke: #56d7ce;
    stroke-linecap: butt;
    stroke-dasharray: 691;
    stroke-dashoffset: 691;
    transition: stroke-dashoffset 1s linear;
    filter: drop-shadow(0 0 6px #37c9b3);
}


.c { 
  width:100%;
  text-align: center;
  color: white;
  margin-bottom:30px;
  text-transform: uppercase;
  padding: 1px;
  font-family: 'Raleway', cursive;
  font-weight: 100;
  position: relative;
  background: linear-gradient(to right, black, #eee, black);
}
.c::before {
  content: "";
  position: absolute;
  left: 50%;
  top: -50px;
  width: 0px;
   pointer-events: none;
  margin-left: -300px;
  margin-top: -220px;
  height: 600px;
  background: radial-gradient(50% 50%, ellipse closest-side, #444, black);
  z-index: -1;
}

.c a {
  background: #040c1f;
  display: block;
  padding: 20px;
  text-decoration: none;
  letter-spacing: 30px;
  color: white;
}

/* TIME TEXT */
.time-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 36px;
    font-weight: bold;
    color: #f8fafc;
}

/* BUTTON */
button {
    margin-top: 30px;
    font-size: 16px;
    padding: 12px 36px;
    border: none;
    border-radius: 8px;
    background: linear-gradient(135deg, #3abcc8, #4e9ab0);
    color: #022c22;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(34,197,94,0.6);
    transition: 0.3s;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 18px rgba(34,197,94,0.9);
}

/* END SCREEN */
.end-screen {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle, #020617, #000);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 64px;
    font-weight: bold;
    color: #2a90aa;
    z-index: 999;
    animation: fadeInSmooth 0.8s ease forwards;
}

@keyframes fadeInSmooth {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}
    </style>
</head>
<body>

    <h1 class="c" style="margin-bottom: 30px"><a href="#0">Hackathon Timer</a></h1>


<div class="timer-box">
    <div class="circle">
        <svg width="250" height="250">
            <circle class="bg" cx="125" cy="125" r="110"></circle>
            <circle class="progress" cx="125" cy="125" r="110"></circle>
        </svg>
        <div id="timer" class="time-text">Waiting</div>
    </div>
</div>


<button id="startBtn">Start</button>

<script>
    const progressCircle = document.querySelector(".progress");
const radius = 110;
const circumference = 2 * Math.PI * radius;
progressCircle.style.strokeDasharray = circumference;

const TIME_URL = "/time";
const START_URL = "/start";

let interval = null;
const timerEl = document.getElementById("timer");

document.getElementById("startBtn").onclick = startTimer;

async function startTimer() {
    await fetch(START_URL);
    document.getElementById("startBtn").style.display = "none";
    runCountdown();
}

async function updateTimerDisplay() {
    const res = await fetch(TIME_URL);
    const data = await res.json();

    if (!data.started) {
        timerEl.innerText = "Waiting";
        return;
    }

    let ms = data.remaining;

    if (ms <= 1000) {
        clearInterval(interval);
        progressCircle.style.strokeDashoffset = 0;
        showEndScreen();
        return;
    }

    let totalSeconds = Math.floor(ms / 1000);

    let hrs = Math.floor(totalSeconds / 3600);
    let mins = Math.floor((totalSeconds % 3600) / 60);
    let secs = totalSeconds % 60;

    let display = "";

    if (hrs > 0) {
        display =
            `${hrs.toString().padStart(2, '0')}:` +
            `${mins.toString().padStart(2, '0')}:` +
            `${secs.toString().padStart(2, '0')}`;
    } else if (mins > 0) {
        display =
            `${mins.toString().padStart(2, '0')}:` +
            `${secs.toString().padStart(2, '0')}`;
    } else {
        display = `${secs.toString().padStart(2, '0')}`;
    }

    timerEl.innerText = display;

    // Circle Progress Logic
    const percent = ms / data.total;  // Make sure backend sends total time
    const offset = circumference - percent * circumference;
    progressCircle.style.strokeDashoffset = offset;
}

async function runCountdown() {
    if (interval) return;

    // Update display immediately
    await updateTimerDisplay();

    interval = setInterval(updateTimerDisplay, 1000);
}

function showEndScreen() {
    const endDiv = document.createElement("div");
    endDiv.className = "end-screen";
    endDiv.innerText = " TIME OVER ";
    document.body.appendChild(endDiv);

    // Screen shake effect
    for (let i = 0; i < 5; i++) {
        setTimeout(() => {
            endDiv.style.transform = i % 2 === 0 ? "translateX(10px)" : "translateX(-10px)";
        }, i * 50);
    }
    setTimeout(() => {
        endDiv.style.transform = "translateX(0)";
    }, 300);

    // Try to play sound
    const audio = new Audio("data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQIAAAAAAA==");
    audio.play().catch(() => {});
}

// Auto-sync
(async () => {
    try {
        const res = await fetch(TIME_URL);
        const data = await res.json();

        if (data.started) {
            document.getElementById("startBtn").style.display = "none";
            runCountdown();
        }
    } catch (err) {
        console.error("Sync error:", err);
    }
})();
</script>
</body>
</html>